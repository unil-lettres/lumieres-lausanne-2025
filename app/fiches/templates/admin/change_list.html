{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'fiches/css/admin.css' %}">
{% endblock %}

{% block branding %}
<div id="branding" class="unil-branding">
    <h1 id="site-name">
        <a href="{% url 'fiches_admin:index' %}">
            <span class="site-logo">Lumières</span>
            <span class="site-subtitle">Lausanne</span>
        </a>
    </h1>
    <p class="site-tagline">Administration du projet</p>
</div>
{% endblock %}

{% block nav-breadcrumbs %}
<nav aria-label="Fil d'Ariane" class="unil-breadcrumbs">
    <div class="breadcrumbs">
        <a href="{% url 'fiches_admin:index' %}">Accueil</a>
        › <a href="{% url 'fiches_admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
        › {{ opts.verbose_name_plural|capfirst }}
    </div>
</nav>
{% endblock %}

{% block content_title %}
<div class="unil-content-header">
    {% if title %}
        <h1 class="unil-page-title">{{ title }}</h1>
    {% endif %}
    {% if cl.result_count %}
        <p class="unil-result-count">
            <span class="count">{{ cl.result_count }}</span> 
            {{ cl.opts.verbose_name_plural }}
            {% if cl.result_count == 1 %}trouvé{% else %}trouvés{% endif %}
        </p>
    {% endif %}
</div>
{% endblock %}

{% block result_list %}
<div class="unil-results-wrapper">
    <div class="results">
        <table id="result_list" class="unil-table">
            <thead>
                <tr>
                    {% for header in result_headers %}
                        <th scope="col" {{ header.class_attrib }}>
                            {% if header.sortable %}
                                {% if header.sort_priority > 0 %}
                                    <div class="sortoptions">
                                        <a class="sortremove" href="{{ header.url_remove }}" title="{% trans 'Remove from sorting' %}"></a>
                                        {% if header.ascending %}
                                            <a href="{{ header.url_toggle }}" class="toggle ascending" title="{% trans 'Toggle sorting' %}"></a>
                                        {% else %}
                                            <a href="{{ header.url_toggle }}" class="toggle descending" title="{% trans 'Toggle sorting' %}"></a>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% endif %}
                            <div class="text">
                                {% if header.sortable %}
                                    <a href="{{ header.url_primary }}">{{ header.text|capfirst }}</a>
                                {% else %}
                                    <span>{{ header.text|capfirst }}</span>
                                {% endif %}
                            </div>
                            {% if header.sortable %}<div class="clear"></div>{% endif %}
                        </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                    {% if result.form and result.form.non_field_errors %}
                        <tr><td colspan="{{ result|length }}">{{ result.form.non_field_errors }}</td></tr>
                    {% endif %}
                    <tr class="{% cycle 'row1' 'row2' %}{% if result.form %} form-row{% if result.form.errors %} errors{% endif %}{% endif %}">
                        {% for item in result %}
                            {{ item }}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block pagination %}
<div class="unil-pagination">
    {% if cl.result_count %}
        <p class="paginator">
            {% if cl.result_count != cl.full_result_count %}
                <span class="filtered-count">
                    {{ cl.result_count }} sur {{ cl.full_result_count }} 
                    {{ cl.opts.verbose_name_plural }}
                </span>
            {% endif %}
            
            {% if cl.paginator.num_pages > 1 %}
                {% for page_num in cl.paginator.page_range %}
                    {% if page_num == cl.paginator.ELLIPSIS %}
                        <span class="ellipsis">…</span>
                    {% elif page_num == cl.page_num %}
                        <span class="this-page">{{ page_num }}</span>
                    {% else %}
                        <a href="{% url cl.opts|admin_urlname:'changelist' %}{% if cl.has_filters %}?{{ cl.preserved_filters|urlencode }}{% if page_num != 1 %}&{% endif %}{% endif %}{% if page_num != 1 %}p={{ page_num }}{% endif %}">{{ page_num }}</a>
                    {% endif %}
                {% endfor %}
            {% endif %}
            
            <span class="total-count">{{ cl.result_count }} {{ cl.opts.verbose_name_plural }}</span>
        </p>
    {% endif %}
</div>
{% endblock %}

{% block filters %}
{% if cl.has_filters %}
<nav id="changelist-filter" aria-labelledby="changelist-filter-header" class="unil-filters">
    <h2 id="changelist-filter-header">Filtres</h2>
    <div id="changelist-filter-extra-actions">
        {% if cl.has_active_filters %}
            <h3>
                <a href="{% url cl.opts|admin_urlname:'changelist' %}" class="clearlink">
                    Effacer les filtres
                </a>
            </h3>
        {% endif %}
        <h3>
            <a href="{% if cl.getvars %}?{{ cl.getvars|urlencode }}&{% endif %}_facets=True" class="viewlink">
                Afficher les nombres
            </a>
        </h3>
    </div>
    
    {% for spec in cl.filter_specs %}
        {% admin_list_filter cl spec %}
    {% endfor %}
</nav>
{% endif %}
{% endblock %}
